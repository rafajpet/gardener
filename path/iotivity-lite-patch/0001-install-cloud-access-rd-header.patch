From e4ab11809cd04c76348fdc08da19a76046826f71 Mon Sep 17 00:00:00 2001
From: rafajpet <rafaj.peter@gmail.com>
Date: Thu, 4 Apr 2019 22:55:29 +0200
Subject: [PATCH] proper pkgconfig file for cloud/rd/st framework lib

---
 port/linux/Makefile                                | 28 +++++++++++++---------
 port/linux/iotivity-constrained-cloudaccess.pc     | 25 +++++++++++++++++++
 port/linux/iotivity-constrained-cloudaccess.pc.in  | 25 +++++++++++++++++++
 port/linux/iotivity-constrained-rd-client.pc       | 25 +++++++++++++++++++
 port/linux/iotivity-constrained-rd-client.pc.in    | 25 +++++++++++++++++++
 .../libiotivity-constrained-cloudaccess.pc.in      | 25 -------------------
 port/linux/libiotivity-constrained-rd-client.pc.in | 25 -------------------
 port/linux/libst-app-framework.pc.in               | 25 -------------------
 port/linux/st-app-framework.pc.in                  | 25 +++++++++++++++++++
 9 files changed, 142 insertions(+), 86 deletions(-)
 create mode 100644 port/linux/iotivity-constrained-cloudaccess.pc
 create mode 100644 port/linux/iotivity-constrained-cloudaccess.pc.in
 create mode 100644 port/linux/iotivity-constrained-rd-client.pc
 create mode 100644 port/linux/iotivity-constrained-rd-client.pc.in
 delete mode 100644 port/linux/libiotivity-constrained-cloudaccess.pc.in
 delete mode 100644 port/linux/libiotivity-constrained-rd-client.pc.in
 delete mode 100644 port/linux/libst-app-framework.pc.in
 create mode 100644 port/linux/st-app-framework.pc.in

diff --git a/port/linux/Makefile b/port/linux/Makefile
index 17c1f97..8a9741c 100644
--- a/port/linux/Makefile
+++ b/port/linux/Makefile
@@ -92,6 +92,12 @@ SRC_RD_CLIENT=$(wildcard ../../service/resource-directory/client/src/*.c)
 HEADERS = $(wildcard ../../include/*.h)
 HEADERS += ../../port/linux/oc_config.h
 
+ifeq ($(CLOUD),1)
+	HEADERS += $(wildcard ../../service/cloud-access/include/*.h)
+	HEADERS += $(wildcard ../../service/resource-directory/client/include/*.h)
+endif
+
+
 HEADERS_COAP = $(wildcard ../../messaging/coap/*.h)
 HEADERS_UTIL = $(wildcard ../../util/*.h)
 HEADERS_UTIL_PT = $(wildcard ../../util/pt/*.h)
@@ -201,14 +207,14 @@ ifeq ($(ST_APP_FW),1)
 
 	#HEADER_DIR +=-I$(ROOT_DIR)/apps/st_app/$(OS)
 	UNIT_TESTS += stapptest
-	PC += libst-app-framework.pc
+	PC += st-app-framework.pc
 endif
 
 ifeq ($(CLOUD),1)
 	CONSTRAINED_LIBS += libiotivity-constrained-cloudaccess.a libiotivity-constrained-cloudaccess.so \
 			libiotivity-constrained-rd-client.a libiotivity-constrained-rd-client.so
 	UNIT_TESTS += cloudaccesstest rdclienttest
-	PC += libiotivity-constrained-rd-client.pc libiotivity-constrained-cloudaccess.pc
+	PC += iotivity-constrained-rd-client.pc iotivity-constrained-cloudaccess.pc
 	SAMPLES += cloud_linux
 endif
 
@@ -310,37 +316,37 @@ libiotivity-constrained-server.a: $(OBJ_COMMON) $(OBJ_SERVER)
 	$(AR) -rcs $@ $(OBJ_COMMON) $(OBJ_SERVER)
 
 libiotivity-constrained-server.so: $(OBJ_COMMON) $(OBJ_SERVER)
-	$(CC) -shared -o $@ $(OBJ_COMMON) $(OBJ_SERVER) $(LIBS)
+	$(CC) ${CFLAGS} -shared -o $@ $(OBJ_COMMON) $(OBJ_SERVER) $(LIBS)
 
 libiotivity-constrained-client.a: $(OBJ_COMMON) $(OBJ_CLIENT)
 	$(AR) -rcs $@ $(OBJ_COMMON) $(OBJ_CLIENT)
 
 libiotivity-constrained-client.so: $(OBJ_COMMON) $(OBJ_CLIENT)
-	$(CC) -shared -o $@ $(OBJ_COMMON) $(OBJ_CLIENT) $(LIBS)
+	$(CC) ${CFLAGS} -shared -o $@ $(OBJ_COMMON) $(OBJ_CLIENT) $(LIBS)
 
 libiotivity-constrained-client-server.a: $(OBJ_COMMON) $(OBJ_CLIENT_SERVER)
 	$(AR) -rcs $@ $(OBJ_COMMON) $(OBJ_CLIENT_SERVER)
 
 libiotivity-constrained-client-server.so: $(OBJ_COMMON) $(OBJ_CLIENT_SERVER)
-	$(CC) -shared -o $@ $(OBJ_COMMON) $(OBJ_CLIENT_SERVER) $(LIBS)
+	$(CC) ${CFLAGS} -shared -o $@ $(OBJ_COMMON) $(OBJ_CLIENT_SERVER) $(LIBS)
 
 libiotivity-constrained-cloudaccess.a: $(OBJ_CA)
 	$(AR) -rcs $@ $(OBJ_COMMON) $(OBJ_CA)
 
 libiotivity-constrained-cloudaccess.so: $(OBJ_CA)
-	$(CC) -shared -o $@ $(OBJ_COMMON) $(OBJ_CA) $(LIBS)
+	$(CC) ${CFLAGS} -shared -o $@ $(OBJ_COMMON) $(OBJ_CA) $(LIBS)
 
 libiotivity-constrained-rd-client.a: $(OBJ_RD_CLIENT)
 	$(AR) -rcs $@ $(OBJ_COMMON) $(OBJ_RD_CLIENT)
 
 libiotivity-constrained-rd-client.so: $(OBJ_RD_CLIENT)
-	$(CC) -shared -o $@ $(OBJ_COMMON) $(OBJ_RD_CLIENT) $(LIBS)
+	$(CC) ${CFLAGS} -shared -o $@ $(OBJ_COMMON) $(OBJ_RD_CLIENT) $(LIBS)
 
 libst-app-framework.a: $(OBJ_ST) $(OBJ_CA) $(OBJ_RD_CLIENT) $(OBJ_COMMON) $(OBJ_CLIENT_SERVER)
 	$(AR) -rcs $@  $(OBJ_ST) $(OBJ_CA) $(OBJ_RD_CLIENT) $(OBJ_COMMON) $(OBJ_CLIENT_SERVER)
 
 libst-app-framework.so: $(OBJ_ST) $(OBJ_CA) $(OBJ_RD_CLIENT) $(OBJ_COMMON) $(OBJ_CLIENT_SERVER)
-	$(CC) -shared -o $@ $(OBJ_ST) $(OBJ_CA) $(OBJ_RD_CLIENT) $(OBJ_COMMON) $(OBJ_CLIENT_SERVER) $(LIBS)
+	$(CC) ${CFLAGS} -shared -o $@ $(OBJ_ST) $(OBJ_CA) $(OBJ_RD_CLIENT) $(OBJ_COMMON) $(OBJ_CLIENT_SERVER) $(LIBS)
 
 server: libiotivity-constrained-server.a $(ROOT_DIR)/apps/server_linux.c
 	@mkdir -p $@_creds
@@ -439,7 +445,7 @@ iotivity-constrained-client-server.pc: iotivity-constrained-client-server.pc.in
 		-e 's,@version@,$(VERSION),' \
 		-e 's,@extra_cflags@,$(EXTRA_CFLAGS),'
 
-libiotivity-constrained-rd-client.pc: libiotivity-constrained-rd-client.pc.in
+iotivity-constrained-rd-client.pc: iotivity-constrained-rd-client.pc.in
 	$(SED) > $@ < $< \
 		-e 's,@prefix@,$(prefix),' \
 		-e 's,@exec_prefix@,$(exec_prefix),' \
@@ -448,7 +454,7 @@ libiotivity-constrained-rd-client.pc: libiotivity-constrained-rd-client.pc.in
 		-e 's,@version@,$(VERSION),' \
 		-e 's,@extra_cflags@,$(EXTRA_CFLAGS),'
 
-libiotivity-constrained-cloudaccess.pc: libiotivity-constrained-cloudaccess.pc.in
+iotivity-constrained-cloudaccess.pc: iotivity-constrained-cloudaccess.pc.in
 	$(SED) > $@ < $< \
 		-e 's,@prefix@,$(prefix),' \
 		-e 's,@exec_prefix@,$(exec_prefix),' \
@@ -457,7 +463,7 @@ libiotivity-constrained-cloudaccess.pc: libiotivity-constrained-cloudaccess.pc.i
 		-e 's,@version@,$(VERSION),' \
 		-e 's,@extra_cflags@,$(EXTRA_CFLAGS),'
 
-libst-app-framework.pc: libst-app-framework.pc.in
+st-app-framework.pc: st-app-framework.pc.in
 	$(SED) > $@ < $< \
 		-e 's,@prefix@,$(prefix),' \
 		-e 's,@exec_prefix@,$(exec_prefix),' \
diff --git a/port/linux/iotivity-constrained-cloudaccess.pc b/port/linux/iotivity-constrained-cloudaccess.pc
new file mode 100644
index 0000000..f28a0dc
--- /dev/null
+++ b/port/linux/iotivity-constrained-cloudaccess.pc
@@ -0,0 +1,25 @@
+# Copyright (c) 2019 Kistler
+#
+# Licensed under the Apache License, Version 2.0 (the "License");
+# you may not use this file except in compliance with the License.
+# You may obtain a copy of the License at
+#
+#      http://www.apache.org/licenses/LICENSE-2.0
+#
+# Unless required by applicable law or agreed to in writing, software
+# distributed under the License is distributed on an "AS IS" BASIS,
+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+# See the License for the specific language governing permissions and
+# limitations under the License.
+
+prefix=/usr/local
+exec_prefix=/usr/local
+libdir=/usr/local/lib
+includedir=/usr/local/include
+
+Name: libiotivity-constrained-cloudaccess
+Description: Iotivity constrained resource directory client library
+Version: 1.0
+Libs.private: -lm -pthread
+Cflags: -I${includedir}/iotivity-constrained  -DOC_PKI -DOC_DYNAMIC_ALLOCATION -DOC_SECURITY -DOC_IPV4 -DOC_TCP
+Libs: -L${libdir} -liotivity-constrained-cloudaccess
diff --git a/port/linux/iotivity-constrained-cloudaccess.pc.in b/port/linux/iotivity-constrained-cloudaccess.pc.in
new file mode 100644
index 0000000..68f7b5f
--- /dev/null
+++ b/port/linux/iotivity-constrained-cloudaccess.pc.in
@@ -0,0 +1,25 @@
+# Copyright (c) 2019 Kistler
+#
+# Licensed under the Apache License, Version 2.0 (the "License");
+# you may not use this file except in compliance with the License.
+# You may obtain a copy of the License at
+#
+#      http://www.apache.org/licenses/LICENSE-2.0
+#
+# Unless required by applicable law or agreed to in writing, software
+# distributed under the License is distributed on an "AS IS" BASIS,
+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+# See the License for the specific language governing permissions and
+# limitations under the License.
+
+prefix=@prefix@
+exec_prefix=@exec_prefix@
+libdir=@libdir@
+includedir=@includedir@
+
+Name: libiotivity-constrained-cloudaccess
+Description: Iotivity constrained resource directory client library
+Version: @version@
+Libs.private: -lm -pthread
+Cflags: -I${includedir}/iotivity-constrained @extra_cflags@
+Libs: -L${libdir} -liotivity-constrained-cloudaccess
diff --git a/port/linux/iotivity-constrained-rd-client.pc b/port/linux/iotivity-constrained-rd-client.pc
new file mode 100644
index 0000000..a21b575
--- /dev/null
+++ b/port/linux/iotivity-constrained-rd-client.pc
@@ -0,0 +1,25 @@
+# Copyright (c) 2019 Kistler
+#
+# Licensed under the Apache License, Version 2.0 (the "License");
+# you may not use this file except in compliance with the License.
+# You may obtain a copy of the License at
+#
+#      http://www.apache.org/licenses/LICENSE-2.0
+#
+# Unless required by applicable law or agreed to in writing, software
+# distributed under the License is distributed on an "AS IS" BASIS,
+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+# See the License for the specific language governing permissions and
+# limitations under the License.
+
+prefix=/usr/local
+exec_prefix=/usr/local
+libdir=/usr/local/lib
+includedir=/usr/local/include
+
+Name: libiotivity-constrained-rd-client
+Description: Iotivity constrained resource directory client library
+Version: 1.0
+Libs.private: -lm -pthread
+Cflags: -I${includedir}/iotivity-constrained  -DOC_PKI -DOC_DYNAMIC_ALLOCATION -DOC_SECURITY -DOC_IPV4 -DOC_TCP
+Libs: -L${libdir} -liotivity-constrained-rd-client
diff --git a/port/linux/iotivity-constrained-rd-client.pc.in b/port/linux/iotivity-constrained-rd-client.pc.in
new file mode 100644
index 0000000..203f384
--- /dev/null
+++ b/port/linux/iotivity-constrained-rd-client.pc.in
@@ -0,0 +1,25 @@
+# Copyright (c) 2019 Kistler
+#
+# Licensed under the Apache License, Version 2.0 (the "License");
+# you may not use this file except in compliance with the License.
+# You may obtain a copy of the License at
+#
+#      http://www.apache.org/licenses/LICENSE-2.0
+#
+# Unless required by applicable law or agreed to in writing, software
+# distributed under the License is distributed on an "AS IS" BASIS,
+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+# See the License for the specific language governing permissions and
+# limitations under the License.
+
+prefix=@prefix@
+exec_prefix=@exec_prefix@
+libdir=@libdir@
+includedir=@includedir@
+
+Name: libiotivity-constrained-rd-client
+Description: Iotivity constrained resource directory client library
+Version: @version@
+Libs.private: -lm -pthread
+Cflags: -I${includedir}/iotivity-constrained @extra_cflags@
+Libs: -L${libdir} -liotivity-constrained-rd-client
diff --git a/port/linux/libiotivity-constrained-cloudaccess.pc.in b/port/linux/libiotivity-constrained-cloudaccess.pc.in
deleted file mode 100644
index 68f7b5f..0000000
--- a/port/linux/libiotivity-constrained-cloudaccess.pc.in
+++ /dev/null
@@ -1,25 +0,0 @@
-# Copyright (c) 2019 Kistler
-#
-# Licensed under the Apache License, Version 2.0 (the "License");
-# you may not use this file except in compliance with the License.
-# You may obtain a copy of the License at
-#
-#      http://www.apache.org/licenses/LICENSE-2.0
-#
-# Unless required by applicable law or agreed to in writing, software
-# distributed under the License is distributed on an "AS IS" BASIS,
-# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-# See the License for the specific language governing permissions and
-# limitations under the License.
-
-prefix=@prefix@
-exec_prefix=@exec_prefix@
-libdir=@libdir@
-includedir=@includedir@
-
-Name: libiotivity-constrained-cloudaccess
-Description: Iotivity constrained resource directory client library
-Version: @version@
-Libs.private: -lm -pthread
-Cflags: -I${includedir}/iotivity-constrained @extra_cflags@
-Libs: -L${libdir} -liotivity-constrained-cloudaccess
diff --git a/port/linux/libiotivity-constrained-rd-client.pc.in b/port/linux/libiotivity-constrained-rd-client.pc.in
deleted file mode 100644
index 203f384..0000000
--- a/port/linux/libiotivity-constrained-rd-client.pc.in
+++ /dev/null
@@ -1,25 +0,0 @@
-# Copyright (c) 2019 Kistler
-#
-# Licensed under the Apache License, Version 2.0 (the "License");
-# you may not use this file except in compliance with the License.
-# You may obtain a copy of the License at
-#
-#      http://www.apache.org/licenses/LICENSE-2.0
-#
-# Unless required by applicable law or agreed to in writing, software
-# distributed under the License is distributed on an "AS IS" BASIS,
-# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-# See the License for the specific language governing permissions and
-# limitations under the License.
-
-prefix=@prefix@
-exec_prefix=@exec_prefix@
-libdir=@libdir@
-includedir=@includedir@
-
-Name: libiotivity-constrained-rd-client
-Description: Iotivity constrained resource directory client library
-Version: @version@
-Libs.private: -lm -pthread
-Cflags: -I${includedir}/iotivity-constrained @extra_cflags@
-Libs: -L${libdir} -liotivity-constrained-rd-client
diff --git a/port/linux/libst-app-framework.pc.in b/port/linux/libst-app-framework.pc.in
deleted file mode 100644
index 5366173..0000000
--- a/port/linux/libst-app-framework.pc.in
+++ /dev/null
@@ -1,25 +0,0 @@
-# Copyright (c) 2019 Kistler
-#
-# Licensed under the Apache License, Version 2.0 (the "License");
-# you may not use this file except in compliance with the License.
-# You may obtain a copy of the License at
-#
-#      http://www.apache.org/licenses/LICENSE-2.0
-#
-# Unless required by applicable law or agreed to in writing, software
-# distributed under the License is distributed on an "AS IS" BASIS,
-# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-# See the License for the specific language governing permissions and
-# limitations under the License.
-
-prefix=@prefix@
-exec_prefix=@exec_prefix@
-libdir=@libdir@
-includedir=@includedir@
-
-Name: libst-app-framework
-Description: Iotivity constrained st app framework
-Version: @version@
-Libs.private: -lm -pthread
-Cflags: -I${includedir}/iotivity-constrained @extra_cflags@
-Libs: -L${libdir} -lst-app-framework
diff --git a/port/linux/st-app-framework.pc.in b/port/linux/st-app-framework.pc.in
new file mode 100644
index 0000000..5366173
--- /dev/null
+++ b/port/linux/st-app-framework.pc.in
@@ -0,0 +1,25 @@
+# Copyright (c) 2019 Kistler
+#
+# Licensed under the Apache License, Version 2.0 (the "License");
+# you may not use this file except in compliance with the License.
+# You may obtain a copy of the License at
+#
+#      http://www.apache.org/licenses/LICENSE-2.0
+#
+# Unless required by applicable law or agreed to in writing, software
+# distributed under the License is distributed on an "AS IS" BASIS,
+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+# See the License for the specific language governing permissions and
+# limitations under the License.
+
+prefix=@prefix@
+exec_prefix=@exec_prefix@
+libdir=@libdir@
+includedir=@includedir@
+
+Name: libst-app-framework
+Description: Iotivity constrained st app framework
+Version: @version@
+Libs.private: -lm -pthread
+Cflags: -I${includedir}/iotivity-constrained @extra_cflags@
+Libs: -L${libdir} -lst-app-framework
-- 
2.7.4

